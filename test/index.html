<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
  <title>jquery-ensure tests</title>    
  <script language="javascript" src="jquery.js" type="text/javascript"></script>
  <script language="javascript" src="testrunner.js" type="text/javascript"></script>
  <script language="javascript" src="../jquery.ensure.js" type="text/javascript"></script>
  <!-- add a script reference to your library here -->
  <link media="screen" href="testsuite.css" type="text/css" rel="stylesheet"/>    
  <style>
    .hidden { display: none; }
  </style>
</head>
<body>

<script language="javascript" type="text/javascript">

// --- SETUP ---

$(function() {
  $('#container1').ensure('addClass', 'ensured');
  $('#container1').find('span').ensure('addClass', 'ensured');
  $('p').ensure('addClass', 'ensured');
  $('a.multi, p.multi').ensure('addClass', 'multi_success');
});

// --- TESTS ---

test("ensure should apply the action to any matching elements on the page", function() {
  ok($('#container1').hasClass('ensured'), 'action was not applied');
});

test("an element should receive the ensured action if it matches the selector", function() {
  $('#container1').append('<p id="match">test</p>');
  ok($('#match').hasClass('ensured'), 'action was not applied');
});

test("ensure should respect the context from which it was called", function() {
  $('#container1').append('<span id="context">test</span>');
  ok($('#context').hasClass('ensured'), 'action was not applied');
});

test("an element should not receive the ensured action if it is not within the context", function() {
  $('#container2').append('<span id="no_context">test</span>');
  ok(!$('#no_context').hasClass('ensured'), 'action was applied');
});

test("child elements should receive the ensured action if they match the selector", function() {
  $('#container1').append('<div><span id="nested">test</span></div>');
  ok($('#nested').hasClass('ensured'), 'action was not applied');
});

test("ensure should support multiple selectors", function() {
  $('body').append('<p id="multi" class="multi">test</p>');
  ok($('#multi').hasClass('multi_success'), 'action was not applied');
});

test("elements already on the page should not be ensured when moving to a new location", function() {
  console.warn('get ready!');
  $('#container1').append($('#move_me'));
  console.warn('done');
  ok(!$('#move_me').hasClass('ensured'), 'action was applied');
});

test("ensure should support adding cloned elements", function() {
  $('#container1').append($('#move_me').clone().attr('id', 'clone'));
  ok($('#clone').hasClass('ensured'), 'action was not applied');
});

test("ensure should support custom jquery methods", function() {
  $.fn.customFn = function() { this.addClass('customized') };
  $('#container1').ensure('customFn');
  ok($('#container1').hasClass('customized'), 'action was not applied');
});


</script>

  <!-- qUnit framework HTML -->
        
  <h1>jquery-ensure</h1>
  <h2 id="banner"></h2>
  <ol id="tests"></ol>
  <div id="results"></div>
  <div id="main"></div>        
  
  <!-- HTML used by tests -->
  <div id="container1" class="hidden"></div>
  <div id="container2" class="hidden"></div>
  <span id="move_me"></span>
        
</body>
</html>

